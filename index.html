<!doctype html>

<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>สืบคดีปริศนาหมอยาตำรับโคมแดง — SS1 & SS2 (โค้ดเดียว)</title>
  <style>
    :root{--bg:#0b0a0a;--panel:#171314;--ink:#f5e9da;--muted:#d8cbb9;--red:#b71c1c;--gold:#c7a56a}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,"Noto Sans Thai",sans-serif;background:var(--bg);color:var(--ink)}
    header{position:sticky;top:0;background:#121011;padding:12px 16px;border-bottom:1px solid #ffffff22}
    h1{margin:0;font-size:18px}
    .wrap{max-width:1000px;margin:auto;padding:16px}
    .tools{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    .btn{padding:8px 12px;border-radius:10px;border:1px solid #ffffff22;background:#ffffff12;color:var(--ink);cursor:pointer}
    .btn.active{background:var(--red);border-color:#e53935}
    input[type="search"]{flex:1;min-width:160px;padding:8px 10px;border-radius:10px;border:1px solid #ffffff22;background:#171314;color:var(--ink)}
    select{padding:8px 10px;border-radius:10px;border:1px solid #ffffff22;background:#171314;color:var(--ink)}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px}
    .card{border:1px solid #ffffff22;border-radius:12px;background:var(--panel);overflow:hidden}
    .thumb{aspect-ratio:16/9;background:#1e1416}
    .meta{padding:10px 12px}
    .ep{font-weight:700;color:var(--gold);font-size:12px}
    .name{margin-top:4px;font-weight:700}
    .actions{display:flex;gap:8px;padding:10px 12px}
    dialog{border:none;border-radius:12px;background:var(--panel);color:var(--ink);width:min(900px,96vw)}
    dialog::backdrop{background:rgba(0,0,0,.7)}
    video{width:100%;max-height:70vh;background:#000;border-radius:10px;border:1px solid #ffffff1a}
    .err{margin-top:8px;color:#ffb3b3;font-size:12px;display:none}
    footer{opacity:.8;text-align:center;padding:18px;font-size:12px}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>สืบคดีปริศนาหมอยาตำรับโคมแดง — SS1 & SS2</h1>
      <div class="tools">
        <button id="ss1Btn" class="btn active">ซีซัน 1</button>
        <button id="ss2Btn" class="btn">ซีซัน 2</button>
        <input id="q" type="search" placeholder="ค้นหา: Ep หรือคำสำคัญ" />
        <select id="numMode" title="เลือกรูปแบบหมายเลขไฟล์">
          <option value="N">Ep.1..24</option>
          <option value="NN">Ep.01..24</option>
        </select>
        <button id="sortBtn" class="btn">สลับเรียงใหม่↔เก่า</button>
      </div>
    </div>
  </header>  <main class="wrap">
    <section id="grid" class="grid"></section>
  </main>  <footer>โค้ดเดียว • ไฟล์ .mp4 อยู่โฟลเดอร์เดียวกับหน้านี้ • ใช้ส่วนตัวเท่านั้น</footer>  <dialog id="modal">
    <div style="padding:12px">
      <h3 id="mTitle" style="margin:0 0 6px">Ep. ??</h3>
      <div id="mMeta" style="opacity:.8;font-size:14px;margin-bottom:8px">—</div>
      <video id="player" controls preload="metadata"></video>
      <div class="err" id="errBox"></div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:10px">
        <a id="openRaw" class="btn" href="#" target="_blank" rel="noopener">เปิดลิงก์ไฟล์</a>
        <button id="mClose" class="btn">ปิด</button>
      </div>
    </div>
  </dialog>  <script>
    /* ================= CONFIG =================
       ปรับชื่อไฟล์ตามที่คุณตั้งจริง (อยู่ในโฟลเดอร์เดียวกับ index.html)
       ใช้ตัวแปร {N} สำหรับ Ep.1..24 หรือ {NN} สำหรับ Ep.01..24
    */
    let NUMBER_MODE = localStorage.getItem('numMode') || 'N'; // 'N' หรือ 'NN'

    // รูปแบบชื่อไฟล์ของแต่ละซีซัน (แก้เฉพาะข้อความไทยตามที่คุณตั้งจริง)
    const FILE_PATTERN_SS1 = 'Ep.{X}หมอยาตำรับโคมแดงSS1.mp4';
    const FILE_PATTERN_SS2 = 'Ep.{X}หมอยาตำรับโคมแดงSS2.mp4';
    // ===========================================

    const $ = (q, el=document)=> el.querySelector(q)
    const grid = $('#grid'), qInput = $('#q'), sortBtn = $('#sortBtn')
    const ss1Btn = $('#ss1Btn'), ss2Btn = $('#ss2Btn'), numModeSel = $('#numMode')

    const modal=$('#modal'), player=$('#player'), mTitle=$('#mTitle'), mMeta=$('#mMeta'), errBox=$('#errBox'), openRaw=$('#openRaw')

    let currentSeason='ss1', sortDesc=false

    function fmtNumber(n){ return NUMBER_MODE==='NN' ? String(n).padStart(2,'0') : String(n) }
    function patternForSeason(){ return currentSeason==='ss1' ? FILE_PATTERN_SS1 : FILE_PATTERN_SS2 }
    function buildName(n){ return patternForSeason().replace('{X}', fmtNumber(n)) }
    function urlEp(n){ return encodeURIComponent(buildName(n)) }

    function buildEpisodes(){
      return Array.from({length:24},(_,i)=>({
        id:i+1,
        title:`Ep. ${String(i+1).padStart(2,'0')}`,
        name:`ตอนที่ ${String(i+1).padStart(2,'0')} — ${currentSeason==='ss1'?'โคมแดง SS1':'โคมแดง SS2'}`,
        url:urlEp(i+1)
      }))
    }

    function card(ep){
      const el=document.createElement('article'); el.className='card'
      el.innerHTML = `
        <div class="thumb"></div>
        <div class="meta">
          <div class="ep">${ep.title}</div>
          <div class="name">${ep.name}</div>
        </div>
        <div class="actions">
          <button class="btn" data-act="play">เล่น</button>
          <a class="btn" href="${ep.url}" target="_blank" rel="noopener">เปิดลิงก์</a>
        </div>`
      el.addEventListener('click',ev=>{ if(ev.target.dataset.act==='play') open(ep) })
      return el
    }

    function render(){
      grid.innerHTML=''
      let data = buildEpisodes()
      if(sortDesc) data.reverse()
      const s=(qInput.value||'').toLowerCase()
      data.filter(ep=> !s || (ep.title+ep.name).toLowerCase().includes(s))
          .forEach(ep=> grid.appendChild(card(ep)))
      // toggle active state
      ss1Btn.classList.toggle('active', currentSeason==='ss1')
      ss2Btn.classList.toggle('active', currentSeason==='ss2')
      // ตั้งค่าตัวเลือกหมายเลขให้ตรง
      numModeSel.value = NUMBER_MODE
    }

    function clearVideoError(){ errBox.textContent=''; errBox.style.display='none' }
    function showVideoError(msg){ errBox.textContent = 'เล่นวิดีโอไม่ได้: ' + msg + ' | URL: ' + player.currentSrc; errBox.style.display='block' }

    function open(ep){
      mTitle.textContent = ep.title
      mMeta.textContent  = ep.name
      clearVideoError()
      const url = ep.url
      player.src = url
      openRaw.href = url
      modal.showModal()
    }

    player.addEventListener('error', ()=>{
      const e = player.error
      const map = {1:'USER_ABORT',2:'NETWORK (โหลดไฟล์ไม่ได้)',3:'DECODE (ถอดรหัสไม่ได้)',4:'SRC_NOT_SUPPORTED (ไฟล์/URL ไม่รองรับ)'}
      showVideoError(e? map[e.code] || ('code='+e.code) : 'ไม่ทราบสาเหตุ')
    })

    // Events
    qInput.oninput = render
    sortBtn.onclick = ()=>{ sortDesc=!sortDesc; render() }
    ss1Btn.onclick = ()=>{ currentSeason='ss1'; render() }
    ss2Btn.onclick = ()=>{ currentSeason='ss2'; render() }
    $('#mClose').onclick = ()=>{ player.pause(); modal.close() }
    numModeSel.onchange = ()=>{ NUMBER_MODE = numModeSel.value; localStorage.setItem('numMode', NUMBER_MODE); render() }

    // start
    render()
  </script></body>
</html>
